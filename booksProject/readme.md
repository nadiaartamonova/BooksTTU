# Books Project API

API документация для Books Project. Этот проект представляет собой веб-приложение для управления библиотекой книг, которое позволяет пользователям просматривать, комментировать книги, а администраторам управлять книгами, категориями и пользователями.

## Сервер

* `http://localhost:3000/api/docs`

## Авторизация

Используется JWT токен. Для авторизованных запросов необходимо передавать токен в заголовке

test
ˇˇˇ
user
{
  "title": "test 3",
  "year": "2345"
}
ˇˇˇ
admin
ˇˇˇ
login: admin 
password: 123
ˇˇˇ

## Секции

* [Auth](#auth)
* [Books](#books)
* [Comments](#comments)
* [Users](#users)
* [Categories](#categories)
* [Logs](#logs)
* [Authors](#authors)

---

## Auth

### `GET /api/auth/me`

Получение информации о текущем пользователе.

**Ответы:**

* `200 OK`: `{ id, login, roles }`
* `401 Unauthorized`
* `403 Forbidden`

---

### `POST /api/auth/register`

Регистрация нового пользователя.

**Body:**

```json
{
  "login": "nadia",
  "password": "123"
}
```

**Ответы:**

* `201 Created`
* `400 Bad Request`
* `500 Server Error`

---

### `POST /api/auth/login`

Аутентификация пользователя.

**Body:**

```json
{
  "login": "nadia",
  "password": "123"
}
```

**Ответы:**

* `200 OK`: возвращает JWT токен
* `401 Unauthorized`
* `500 Server Error`

---

## Books

### `GET /api/books`

Получить список всех книг с авторами и категориями.

### `POST /api/books`

Создать книгу (Admin).

```json
{
  "title": "Преступление и наказание",
  "year": 1866,
  "authorIds": [1, 2],
  "categoryIds": [3, 4]
}
```

### `GET /api/books/search?query=...`

Поиск книг по названию.

### `GET /api/books/:id`

Получить одну книгу по ID (с авторами и категориями).

### `PUT /api/books/:id`

Обновить книгу (Admin).

```json
{
  "title": "Новая книга",
  "year": 2020,
  "authorIds": [1],
  "categoryIds": [2, 3]
}
```

### `DELETE /api/books/:id`

Удалить книгу (Admin).

---

## Comments

### `POST /api/comments`

Создать комментарий (только авторизованные).

```json
{
  "content": "Отличная книга!",
  "BookID": 1
}
```

### `GET /api/comments/book/:bookId`

Получить комментарии к книге.

### `PUT /api/comments/:id`

Редактировать комментарий (только автор).

### `DELETE /api/comments/:id`

Удалить комментарий (автор или админ).

---

## Users

### `POST /api/users/:userId/roles`

Назначить роль пользователю (Admin).

```json
{
  "roleId": 2
}
```

---

## Categories

### `GET /api/categories`

Список категорий.

### `POST /api/categories`

Создание категории (Admin).

```json
{
  "name": "Роман"
}
```

### `GET /api/categories/:id`

Получение категории по ID.

### `PUT /api/categories/:id`

Обновление категории (Admin).

### `DELETE /api/categories/:id`

Удаление категории (Admin).

---

## Logs

### `GET /api/logs`

Получить список логов действий пользователей (Admin).

---

## Authors

### `GET /api/authors`

Получить список всех авторов.

### `POST /api/authors`

Создание автора (Admin).

```json
{
  "firstName": "Лев",
  "lastName": "Толстой"
}
```

### `GET /api/authors/:id`

Получение автора по ID.

### `PUT /api/authors/:id`

Обновление автора (Admin).

### `DELETE /api/authors/:id`

Удаление автора (Admin).

---

## Примечания

* Все Admin-only маршруты требуют авторизации и наличия роли Admin.
* Для авторизованных запросов необходимо передавать заголовок Authorization.


# Валидация данных (Backend)

## Автор (`/api/authors`)
### Создание автора
- `firstName`: **обязательное** строковое поле.
- `lastName`: **обязательное** строковое поле.

### Обновление автора
- Проверяется существование автора по `id`.
- Обновляются только переданные поля (`firstName`, `lastName`).

## Категория (`/api/categories`)
### Создание категории
- `name`: **обязательное** строковое поле.

### Обновление категории
- Проверяется наличие категории по `id`.
- Обновляется поле `name`.

## Книга (`/api/books`)
### Создание книги
- `title`: **обязательное** строковое поле (не должно быть пустым или состоять из пробелов).
- `year`: **обязательное** числовое поле. Допустимое значение — от `1500` до текущего года.
- `authorIds`: **обязательный массив ID** авторов. Должен содержать хотя бы одного автора.
- `categoryIds`: **обязательный массив ID** категорий. Должен содержать хотя бы одну категорию.

**Дополнительно:**
- Проверяется существование всех указанных `authorIds` и `categoryIds`.
- Если хотя бы один не существует — возвращается `400 Bad Request`.

### Обновление книги
- Проверяется, существует ли книга по `id`.
- Выполняются те же проверки, что и при создании.

## Комментарий (`/api/comments`)
### Создание комментария
- `content`: **обязательное** текстовое поле (не должно быть пустым).
- `BookID`: **обязательное** числовое поле. Должен указывать на существующую книгу.

### Обновление / Удаление
- Только автор комментария может редактировать или удалять его.
- Администратор также может удалять любой комментарий.

## Назначение роли (`/api/users/:userId/roles`)
- Проверяется существование пользователя (`userId`) и роли (`roleId`).
- Если у пользователя уже есть роль — она удаляется перед назначением новой.
- Только **администратор** может назначать роли.
- При попытке повторного назначения той же роли возвращается ошибка.

## Поиск книг (`/api/books/search`)
- `query`: **обязательный** параметр в строке запроса.
- Поиск осуществляется по:
  - названию книги;
  - имени или фамилии автора;
  - названию категории.
